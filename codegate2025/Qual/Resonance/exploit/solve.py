import pwn
import os
pwn.context.log_level = "DEBUG"

DEBUG = False
if DEBUG:
    os.chdir("../prob/for_organizer")
    tn = pwn.process(["sage", "chall.sage"])
else:
    # IP, PORT = "localhost", 10955
    IP, PORT = "3.35.158.203", 10955
     
    tn = pwn.remote(IP, PORT)
    
    def PoW():
        import subprocess

        tn.recvuntil(b"python3 <(curl -sSL https://goo.gle/kctf-pow) solve ")
        token = tn.recvline(keepends=False).decode()
        pwn.log.info(f"PoW token = {token}")
        result = subprocess.run(
            f'bash -c "python3 <(curl -sSL https://goo.gle/kctf-pow) solve {token}"',
            shell=True,
            capture_output=True,
        ).stdout.strip()
        pwn.log.info(f"PoW solution = {result.decode()}")
        tn.sendlineafter(b"Solution? ", result)
        validation = tn.recvline(keepends=False).decode()
        pwn.log.info(f"PoW {validation = }")

    PoW()

bitlen = 1255
for _ in range(3):
    tn.sendline(str(bitlen).encode())

msgs = [
    600226098861692247242530231586821389555085399663187963595046873758835564305202943832296520307002652677312103312281126499510418848527539540202436927233038631766381705551594449932013773177981515502988492260180842114398665993560236637681364126853699253886789706009554194167040406653110902461738410240435827570079356225413622480255821189276401012871521279902812726767459056775354938,
    343387450810478534926471051344172437827685582852776030583339656117293332103693437514806354258993996101467025370891315665726473175983961148170511179055149010329823350851038383556066343884538181104753493056711202259496124836100303960688284344514693473067313030645904978898740110707638599803075879472412108000773015335643376848322160370530521426397106527717076546708994197084861254,
    379863859509969300770655584653364283490066254324636683230879880447513571003756553813931548407597218901717430407475570295112973445435609997904236960625753872315087265931786763739606983058998082493849156060873400334493902579352879667811003364449418927116942171076054923401789387749141655936629489535561165091173324296198588738483350410176289675103006247732041201775274568068465879,
]
for msg in msgs:
    tn.sendline(str(msg).encode())

tn.interactive()
